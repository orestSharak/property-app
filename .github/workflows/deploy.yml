name: Manual Deployment (Hosting Only)

on:
  # Changes the trigger from 'push' to manual 'workflow_dispatch'
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to deploy from'
        required: true
        default: 'main'
        type: choice
        options:
          - main
          - master

jobs:
  build_and_deploy:
    name: Build & Deploy Hosting
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        # Checkout the branch selected by the user in the manual trigger
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.branch }}

      - name: Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      # 1. Install dependencies and run the build
      - name: Build Project
        run: npm ci && npm run build

      # 2. Deploy only Hosting using the dedicated action
      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          # Use the specific Service Account name generated by the CLI
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_MAP_MARKERS_ED36E }}
          channelId: live
          projectId: map-markers-ed36e
          # The action will find the 'dist' folder based on firebase.json

      - name: Deployment Success Message
        run: echo "Manual deployment to Hosting (live channel) completed successfully from branch ${{ github.event.inputs.branch }}"
